<div class="register-container">
 
  <div class="welcome-side">
    <h2>Bienvenue √† nouveau‚ÄØ!</h2>
    <p>Vous avez d√©j√† un compte‚ÄØ?</p>
    <button routerLink="/login" class="btn-outline">Se connecter</button>
  </div>

  <!-- üßæ Form Side -->
  <div class="form-side">
    <div class="form-scroll">
   <!-- üîµ Loader (centr√© au milieu de la page) -->
<div *ngIf="loading" class="loading-alert">
  <div class="spinner"></div>
  <p>Cr√©ation du compte...</p>
</div>

<!-- ‚úÖ Message de succ√®s -->
<div *ngIf="successMessage" class="alert alert-success">
  {{ successMessage }}
  <button class="close" (click)="successMessage = ''">&times;</button>
</div>

<!-- ‚ùå Message d‚Äôerreur -->
<div *ngIf="errorMessage" class="alert alert-danger">
  {{ errorMessage }}
  <button class="close" (click)="errorMessage = ''">&times;</button>
</div>


    <form [formGroup]="registerForm" (ngSubmit)="onRegister()">

  <!-- Role toggle reste inchang√© -->
  <div class="modern-role-toggle">
    <input type="radio" id="client" formControlName="role" value="client" checked />
    <label for="client">Client</label>

    <input type="radio" id="prestataire" formControlName="role" value="prestataire" />
    <label for="prestataire">Prestataire</label>

    <div class="toggle-highlight"></div>
  </div>

  <!-- Profile Photo -->
  <div class="form-group profile-upload">
    <label class="profile-label">Photo de profil</label>
    <div class="avatar-wrapper" (click)="onAvatarClick()">
      <div *ngIf="!photoPreview" class="camera-center">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 7h3l2-2h6l2 2h3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        
      </div>
      <img *ngIf="photoPreview" [src]="photoPreview" alt="Profile preview" class="avatar-img" />
    </div>
    <input #photoInput id="photoInput" type="file" accept="image/*" (change)="onPhotoSelected($event)" style="display: none;" />
    <button type="button" *ngIf="photoPreview" class="remove-photo-btn" (click)="removePhoto()">Remove</button>
    <small *ngIf="showError.photo" class="text-danger">
    Photo de profil requise.
  </small>
  </div>

  <!-- Full Name -->
  <div class="form-group">
    <input type="text" placeholder="Nom complet" formControlName="name" (focus)="onFocus('name')" />
    <small *ngIf="showError.name && registerForm.controls['name'].invalid" class="text-danger">
      Nom complet requis.
    </small>
  </div>

  <!-- Email -->
  <div class="form-group">
    <input type="email" placeholder="Email" formControlName="email" (focus)="onFocus('email')" />
    <small *ngIf="showError.email && registerForm.controls['email'].invalid" class="text-danger">
      <span *ngIf="registerForm.controls['email'].errors?.['required']">Email est requis.</span>
      <span *ngIf="registerForm.controls['email'].errors?.['email']">Email non valide.</span>
    </small>
  </div>

  <!-- Password -->
<div class="form-group password-group">
  <input
    [type]="passwordVisible ? 'text' : 'password'"
    placeholder="Mot de passe"
    formControlName="password"
    (focus)="onFocus('password')"
  />
  <i
    class="fas"
    [ngClass]="passwordVisible ? 'fa-eye' : 'fa-eye-slash'"
    (click)="togglePasswordVisibility()"
  ></i>

  <small
    *ngIf="showError.password && registerForm.controls['password'].invalid"
    class="text-danger"
  >
    Mot de passe requis.
  </small>
</div>


  <!-- Phone Number -->
  <div class="form-group">
    <input type="text" placeholder="Num√©ro de t√©l√©phone" formControlName="telephone" (focus)="onFocus('telephone')" />
    <small *ngIf="showError.telephone && registerForm.controls['telephone'].invalid" class="text-danger">
      Num√©ro de t√©l√©phone requis.
    </small>
  </div>
<!-- Address -->
<div class="form-group" formGroupName="adresse">
  <input
    type="text"
    placeholder="Adresse"
    formControlName="street"
    (focus)="onFocus('adresse')"
  />

  <small *ngIf="showError.adresse && registerForm.get('adresse.street')?.invalid" class="text-danger">
    Adresse requise.
  </small>
</div>

  
    <!-- üåç MAP + bouton GPS -->

<div class="map-section">

  <div class="map-search-row">
    <input 
      type="text" 
      placeholder="Recherche une adresse‚Ä¶" 
      #searchInput 
      class="map-search-input"
    >

    <button type="button" class="map-icon-btn" (click)="search(searchInput.value)" title="Rechercher">
      <i class="fas fa-search"></i>
    </button>
  </div>

  <div id="map"></div>

  <button type="button" class="map-icon-btn map-gps-btn" (click)="locate()" title="Ma position">
  <i class="fas fa-location-crosshairs"></i>
</button>

</div>

  <!-- Champs prestataire -->
  <div *ngIf="registerForm.get('role')?.value === 'prestataire'" class="provider-fields">

    <div class="form-group">
  
  <select id="category" formControlName="category" (focus)="onFocus('category')">
    <option value="">-- S√©lectionnez une cat√©gorie de service --</option>
    <option value="m√©nage">M√©nage</option>
    <option value="babysitting">Babysitting</option>
    <option value="√©lectricit√©">√âlectricit√©</option>
    <option value="jardinage">Jardinage</option>
    <option value="peinture">Peinture</option>
    <option value="d√©m√©nagement">D√©m√©nagement</option>
    <option value="climatisation">Climatisation</option>
    <option value="propret√©">Propret√©</option>
  </select>

  <small *ngIf="showError.category && registerForm.controls['category'].invalid" class="text-danger">
    Cat√©gorie requise.
  </small>
</div>


    <div class="form-group">
      <textarea placeholder="Description" formControlName="description" (focus)="onFocus('description')"></textarea>
      <small *ngIf="showError.description && registerForm.controls['description'].invalid" class="text-danger">
        Description requise.
      </small>
    </div>

    <div class="form-group">
      <input type="number" placeholder="Exp√©rience (en ann√©es)" formControlName="experience" (focus)="onFocus('experience')" />
      <small *ngIf="showError.experience && registerForm.controls['experience'].invalid" class="text-danger">
        Exp√©rience requise.
      </small>
    </div>

    <!-- Uploads restent inchang√©s -->
    <div class="form-group upload-section">
      <label for="certificationsUpload" class="upload-label">T√©l√©charger les certifications (PDF)</label>
      <input id="certificationsUpload" type="file" multiple (change)="onCertificationsSelected($event)" accept=".pdf" />
       <small *ngIf="showError.certifications" class="text-danger">
    Veuillez t√©l√©charger au moins une certification.
  </small>
    </div>

    <div class="form-group upload-section">
      <label for="documentsUpload" class="upload-label">T√©l√©charger les documents (PDF or Images)</label>
      <input id="documentsUpload" type="file" multiple (change)="onDocumentsSelected($event)" accept=".pdf,.jpg,.jpeg,.png" />
    <small *ngIf="showError.documents" class="text-danger">
    Veuillez t√©l√©charger au moins un document.
  </small>
    </div>
    <!-- üìÖ Disponibilit√©s du prestataire -->
<div class="availability-section">

  <h3>Disponibilit√©s</h3>
   <div *ngIf="disponibilite.errors?.['required']" class="text-danger mb-2">
    Veuillez s√©lectionner au moins un jour de disponibilit√©.
  </div>
  <div class="day" *ngFor="let day of disponibilite.controls; let i = index">
  <small *ngIf="day.errors?.['required']" class="text-danger">
    Au moins un cr√©neau est requis pour ce jour.
  </small>

  <label>
    <input type="checkbox" [formControl]="getControl(day, 'isAvailable')" />
    {{ day.get('day')?.value | titlecase }}
  </label>

  <!-- Cr√©neaux si dispo -->
  <div *ngIf="day.get('isAvailable')?.value">

    <!-- Tous les cr√©neaux du jour -->
    <div *ngFor="let slot of getTimeSlots(i).controls; let j = index" class="timeslot-wrapper">
      <div class="timeslot">
        <input type="time" [formControl]="getControl(slot, 'start')" />
        <input type="time" [formControl]="getControl(slot, 'end')" />
        <button type="button" (click)="removeTimeSlot(i, j)">X</button>
      </div>
      <small *ngIf="slot.errors?.['invalidTime']" class="text-danger timeslot-error">
        Cr√©neau invalide.
      </small>
    </div>

    <!-- Bouton Ajouter un cr√©neau -->
    <button type="button" (click)="addTimeSlot(i)">
      Ajouter un cr√©neau
    </button>

  </div>
</div>

</div>

  </div>

  <button type="submit" class="btn-primary">S'inscrire</button>
</form>

  </div>
  </div>
</div>
