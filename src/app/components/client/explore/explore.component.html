<!-- Hero Section -->
<section class="hero-section">
  <div class="hero-background">
    <div class="hero-pattern"></div>
  </div>
  <div class="hero-content">
    <div class="hero-badge">üèÜ Plateforme #1 en Tunisie</div>
    <h1 class="hero-title">Explorez Nos Services Premium</h1>
    <p class="hero-subtitle">Des professionnels v√©rifi√©s et qualifi√©s √† votre service</p>
  </div>
</section>

<!-- Main Container -->
<div class="main-container">
  
  <!-- Top Filters Bar -->
  <div class="filters-bar">
    <div class="filters-container">
      <!-- Categories Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="label-icon">üìÇ</span>
          Cat√©gories
        </label>
        <div class="filter-dropdown">
          <select [(ngModel)]="selectedCategory" class="custom-select">
            <option *ngFor="let category of categories" [value]="category.name">
              {{ category.icon }} {{ category.name }}
            </option>
          </select>
        </div>
      </div>

      <!-- Rating Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="label-icon">‚≠ê</span>
          √âvaluation
        </label>
        <div class="filter-dropdown">
          <select [(ngModel)]="selectedRating" class="custom-select">
            <option value="all">Toutes les notes</option>
            <option value="4.5">4.5+ Excellent</option>
            <option value="4.0">4.0+ Tr√®s bien</option>
          </select>
        </div>
      </div>

      <!-- Price Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="label-icon">üí∞</span>
          Prix
        </label>
        <div class="filter-dropdown">
          <select [(ngModel)]="selectedPrice" class="custom-select">
            <option value="all">Tous les prix</option>
            <option value="low">√âconomique (&lt; 40 DT)</option>
            <option value="medium">Standard (40-60 DT)</option>
            <option value="high">Premium (&gt; 60 DT)</option>
          </select>
        </div>
      </div>

      <!-- Reset Button -->
      <button 
        class="reset-filters-btn" 
        (click)="selectCategory('Tous'); selectedRating='all'; selectedPrice='all'"
        *ngIf="selectedCategory !== 'Tous' || selectedRating !== 'all' || selectedPrice !== 'all'">
        <span class="reset-icon">‚Üª</span>
        R√©initialiser
      </button>
    </div>
  </div>

  <!-- Category Pills (Quick Access) -->
  <div class="category-pills-section">
    <div class="pills-header">
      <h3 class="pills-title">Acc√®s Rapide</h3>
      <p class="pills-subtitle">S√©lectionnez une cat√©gorie pour filtrer rapidement</p>
    </div>
    <div class="category-pills">
      <button 
        *ngFor="let category of categories" 
        class="category-pill"
        [class.active]="selectedCategory === category.name"
        (click)="selectCategory(category.name)">
        <span class="pill-icon">{{ category.icon }}</span>
        <span class="pill-text">{{ category.name }}</span>
        <span class="pill-check" *ngIf="selectedCategory === category.name">‚úì</span>
      </button>
    </div>
  </div>

  <!-- Results Header -->
  <div class="results-header">
    <div class="results-info">
      <h2 class="results-title">
        <span class="results-text">Services Disponibles</span>
      </h2>
      <p class="results-subtitle">Les meilleurs professionnels pour vos besoins</p>
    </div>
    
    <!-- View Toggle -->
    <div class="view-toggle">
      <button class="toggle-btn" [class.active]="!showMap" (click)="showMap = false">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
        </svg>
        Grille
      </button>
      <button class="toggle-btn" [class.active]="showMap" (click)="toggleMap()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        Carte
      </button>
    </div>
  </div>

  <!-- Map View -->
  <div class="map-section" *ngIf="showMap && !loading">
    <div class="map-header">
      <h3>üìç Tous les prestataires sur la carte</h3>
      <p>Cliquez sur un marqueur pour voir les d√©tails</p>
    </div>
    <div id="explore-map" class="explore-map-container"></div>
    <div class="map-legend">
      <span class="legend-item"><span class="marker blue"></span> Plomberie, Climatisation</span>
      <span class="legend-item"><span class="marker green"></span> M√©nage, Jardinage</span>
      <span class="legend-item"><span class="marker orange"></span> Peinture</span>
      <span class="legend-item"><span class="marker red"></span> D√©m√©nagement</span>
    </div>
  </div>

  <!-- Active Filters Badges -->
  <div class="active-filters" *ngIf="!showMap && (selectedCategory !== 'Tous' || selectedRating !== 'all' || selectedPrice !== 'all')">
    <span class="filters-label">Filtres actifs:</span>
    <div class="filters-badges">
      <span class="filter-badge" *ngIf="selectedCategory !== 'Tous'">
        <span class="badge-icon">üìÇ</span>
        {{ selectedCategory }}
        <button class="remove-badge" (click)="selectCategory('Tous')">√ó</button>
      </span>
      <span class="filter-badge" *ngIf="selectedRating !== 'all'">
        <span class="badge-icon">‚≠ê</span>
        {{ selectedRating }}+ √©toiles
        <button class="remove-badge" (click)="selectedRating='all'">√ó</button>
      </span>
      <span class="filter-badge" *ngIf="selectedPrice !== 'all'">
        <span class="badge-icon">üí∞</span>
        {{ selectedPrice === 'low' ? '√âconomique' : selectedPrice === 'medium' ? 'Standard' : 'Premium' }}
        <button class="remove-badge" (click)="selectedPrice='all'">√ó</button>
      </span>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner"></div>
    <p>Chargement des prestataires...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !loading">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Erreur de chargement</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadProviders()">R√©essayer</button>
  </div>

  <!-- Providers Grid -->
  <div class="services-grid" *ngIf="!loading && !error && !showMap">
    <div class="service-card" *ngFor="let provider of filteredProviders">
      <!-- Premium Photo Header -->
      <div class="photo-header">
        <div class="provider-photo-container">
          <img 
            [src]="getProviderPhoto(provider)" 
            [alt]="provider.user.nom + ' ' + provider.user.prenom"
            class="provider-photo"
            
          />
          <div class="photo-overlay">
            <div class="overlay-gradient"></div>
            <div class="photo-badges">
              <span class="verified-badge-premium" *ngIf="provider.isVerified">
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 0l2.5 5.5L18 6.5l-4.5 4L14.5 16 10 13l-4.5 3 1-5.5L2 6.5l5.5-1z"/>
                </svg>
                V√©rifi√©
              </span>
              <span class="category-badge-premium">{{ provider.metier }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Card Body -->
      <div class="card-body">
        <div class="provider-info-header">
          <h3 class="provider-name">{{ provider.user.nom }} {{ provider.user.prenom }}</h3>
          <div class="rating-inline">
            <span class="star-icon-inline">‚≠ê</span>
            <span class="rating-value-inline">{{ provider.noteGenerale }}</span>
          </div>
        </div>
        
        <div class="service-meta-premium">
          <span class="meta-item-premium">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            {{ provider.experience || 0 }} ans
          </span>
          <span class="meta-item-premium">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            {{ getAddressString(provider) }}
          </span>
        </div>

        <p class="service-description-premium">
          {{ provider.description || 'Professionnel exp√©riment√© et qualifi√© dans le domaine. Services de haute qualit√© garantis.' }}
        </p>

        <!-- Small Map for Provider Location -->
        <div class="card-map-container" *ngIf="hasValidCoordinates(provider)">
          <div [id]="'map-' + provider._id" class="card-map"></div>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
          <div class="stat-item">
            <span class="stat-icon">üìã</span>
            <div class="stat-content">
              <span class="stat-number">{{ provider.nombreAvis }}</span>
              <span class="stat-label">Avis</span>
            </div>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-icon">‚úÖ</span>
            <div class="stat-content">
              <span class="stat-number">{{ (provider.experience || 0) * 20 || 10 }}+</span>
              <span class="stat-label">Services</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Card Footer with Two Options -->
      <div class="card-footer-premium">
        <button class="btn-profile-premium" (click)="viewProviderProfile(provider._id)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          Voir Profil
        </button>
        <button class="btn-book-premium" (click)="bookProvider(provider._id)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          R√©server
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredProviders.length === 0 && !loading">
    <div class="empty-illustration">
      <div class="empty-icon">üîç</div>
      <div class="empty-circle"></div>
    </div>
    <h3 class="empty-title">Aucun service trouv√©</h3>
    <p class="empty-text">
      Nous n'avons pas trouv√© de services correspondant √† vos crit√®res.<br>
      Essayez de modifier vos filtres pour √©largir la recherche.
    </p>
    <button class="btn-reset" (click)="selectCategory('Tous'); selectedRating='all'; selectedPrice='all'">
      <span class="reset-icon">‚Üª</span>
      R√©initialiser tous les filtres
    </button>
  </div>

</div>
