<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Chargement des d√©tails...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-icon">‚ö†Ô∏è</div>
  <h3>Erreur</h3>
  <p>{{ error }}</p>
  <button class="retry-btn" (click)="loadProviderDetails()">R√©essayer</button>
</div>

<!-- Provider Details -->
<div class="provider-details-container" *ngIf="provider && !loading">
  <!-- Hero Section with Photo -->
  <div class="hero-section">
    <button class="back-btn" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Retour
    </button>

    <div class="hero-content">
      <div class="hero-left">
        <div class="provider-photo-wrapper">
          <img 
            [src]="getProviderPhoto()" 
            [alt]="provider.user.nom + ' ' + provider.user.prenom"
            class="provider-photo-large"
          />
          <div class="photo-badge verified" *ngIf="provider.isVerified">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 0l2.5 5.5L18 6.5l-4.5 4L14.5 16 10 13l-4.5 3 1-5.5L2 6.5l5.5-1z"/>
            </svg>
            V√©rifi√©
          </div>
        </div>
      </div>

      <div class="hero-right">
        <div class="category-badge-hero">{{ provider.metier }}</div>
        <h1 class="provider-name-hero">{{ provider.user.prenom }} {{ provider.user.nom }}</h1>
        
        <div class="rating-section-hero">
          <div class="stars-large">
            <span *ngFor="let star of getStarsArray(provider.noteGenerale)" 
                  class="star-filled">‚≠ê</span>
            <span *ngFor="let star of getStarsArray(5 - provider.noteGenerale)" 
                  class="star-empty">‚òÜ</span>
          </div>
          <span class="rating-number-hero">{{ provider.noteGenerale }}/5.0</span>
          <span class="reviews-count-hero">({{ provider.nombreAvis }} avis)</span>
        </div>

        <div class="quick-info">
          <div class="info-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <div class="info-content">
              <span class="info-label">Exp√©rience</span>
              <span class="info-value">{{ provider.experience || 0 }} ans</span>
            </div>
          </div>

          <div class="info-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            <div class="info-content">
              <span class="info-label">Localisation</span>
              <span class="info-value">{{ getAddressString() }}</span>
            </div>
          </div>

          <div class="info-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            <div class="info-content">
              <span class="info-label">T√©l√©phone</span>
              <span class="info-value">{{ provider.user.telephone || 'Non fourni' }}</span>
            </div>
          </div>
        </div>

        <button class="btn-book-hero" (click)="bookProvider()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          R√©server maintenant
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="content-grid">
      <!-- Left Column -->
      <div class="left-column">
        <!-- About Section -->
        <div class="section-card about-section">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <h2 class="section-title">√Ä propos</h2>
          </div>
          <p class="description-text">
            {{ provider.description || 'Professionnel exp√©riment√© et qualifi√© dans le domaine. Services de haute qualit√© garantis avec un engagement envers la satisfaction client.' }}
          </p>
        </div>

        <!-- Certifications Section -->
        <div class="section-card certifications-section" *ngIf="provider.certifications && provider.certifications.length > 0">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10 9 9 9 8 9"/>
            </svg>
            <h2 class="section-title">Certifications & Documents</h2>
          </div>
          <div class="certifications-grid">
            <div class="certification-item" *ngFor="let cert of provider.certifications; let i = index">
              <div class="cert-icon">üìÑ</div>
              <div class="cert-info">
                <span class="cert-name">Document {{ i + 1 }}</span>
                <a [href]="cert" target="_blank" class="cert-link">Voir le document</a>
              </div>
            </div>
          </div>
        </div>

        <!-- Reviews Section -->
        <div class="section-card reviews-section">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            <h2 class="section-title">Avis clients ({{ provider.nombreAvis }})</h2>
          </div>

          <div class="reviews-list" *ngIf="provider.reviews && provider.reviews.length > 0">
            <div class="review-item" *ngFor="let review of provider.reviews">
              <div class="review-header">
                <div class="review-avatar">
                  {{ review.client.prenom.charAt(0) }}{{ review.client.nom.charAt(0) }}
                </div>
                <div class="review-info">
                  <span class="review-author">{{ review.client.prenom }} {{ review.client.nom }}</span>
                  <div class="review-stars">
                    <span *ngFor="let star of getStarsArray(review.note)" class="star-small">‚≠ê</span>
                  </div>
                </div>
                <span class="review-date">{{ formatDate(review.createdAt) }}</span>
              </div>
              <p class="review-comment">{{ review.commentaire }}</p>
            </div>
          </div>

          <div class="no-reviews" *ngIf="!provider.reviews || provider.reviews.length === 0">
            <div class="no-reviews-icon">üí¨</div>
            <p>Aucun avis pour le moment</p>
            <span>Soyez le premier √† laisser un avis !</span>
          </div>
        </div>
      </div>

      <!-- Right Column - Sidebar -->
      <div class="right-column">
        <!-- Contact Card -->
        <div class="section-card contact-card">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
            </svg>
            <h3 class="section-title">Contacter</h3>
          </div>
          
          <div class="contact-info">
            <div class="contact-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              <div>
                <span class="contact-label">Email</span>
                <span class="contact-value">{{ provider.user.email }}</span>
              </div>
            </div>

            <div class="contact-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
              <div>
                <span class="contact-label">T√©l√©phone</span>
                <span class="contact-value">{{ provider.user.telephone || 'Non fourni' }}</span>
              </div>
            </div>

            <div class="contact-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              <div>
                <span class="contact-label">Adresse</span>
                <span class="contact-value">{{ getAddressString() }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Map Card -->
        <div class="section-card map-card" *ngIf="hasValidCoordinates() && isBrowser()">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            <h3 class="section-title">Localisation</h3>
          </div>
          <div id="provider-map" class="map-container"></div>
          <div class="map-info">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <span>Localisation exacte du prestataire</span>
          </div>
        </div>

        <!-- Availability Card -->
        <div class="section-card availability-card" *ngIf="getAvailableDays().length > 0">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <h3 class="section-title">Disponibilit√©</h3>
          </div>

          <div class="availability-list">
            <div class="availability-item" *ngFor="let avail of getAvailableDays()">
              <span class="day-name">{{ getDayName(avail.day) }}</span>
              <div class="time-slots">
                <span class="time-slot" *ngFor="let slot of avail.timeSlots">
                  {{ slot.start }} - {{ slot.end }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats Card -->
        <div class="section-card stats-card">
          <div class="section-header">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="20" x2="12" y2="10"/>
              <line x1="18" y1="20" x2="18" y2="4"/>
              <line x1="6" y1="20" x2="6" y2="16"/>
            </svg>
            <h3 class="section-title">Statistiques</h3>
          </div>

          <div class="stats-grid">
            <div class="stat-box">
              <div class="stat-icon">‚≠ê</div>
              <div class="stat-value">{{ provider.noteGenerale }}/5</div>
              <div class="stat-label">Note moyenne</div>
            </div>

            <div class="stat-box">
              <div class="stat-icon">üí¨</div>
              <div class="stat-value">{{ provider.nombreAvis }}</div>
              <div class="stat-label">Avis</div>
            </div>

            <div class="stat-box">
              <div class="stat-icon">üèÜ</div>
              <div class="stat-value">{{ provider.experience || 0 }}</div>
              <div class="stat-label">Ann√©es</div>
            </div>

            <div class="stat-box">
              <div class="stat-icon">‚úÖ</div>
              <div class="stat-value">{{ provider.isVerified ? 'Oui' : 'Non' }}</div>
              <div class="stat-label">V√©rifi√©</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
