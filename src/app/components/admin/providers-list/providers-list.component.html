<div class="min-h-screen bg-white">
  <div class="max-w-7xl mx-auto px-6 py-6">
    <!-- üéØ En-t√™te -->
    <div class="mb-8 mt-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">
        Gestion des prestataires
      </h1>
      <p class="text-gray-600">
        Contr√¥lez la qualit√© et validez les nouveaux prestataires
      </p>
    </div>

    <!-- üìä Statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <!-- Total -->
      <div
        class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-blue-100 text-sm font-medium">Total</p>
            <p class="text-3xl font-bold mt-1">{{ stats.total }}</p>
          </div>
          <i class="pi pi-users text-4xl opacity-50"></i>
        </div>
      </div>

      <!-- En attente -->
      <div
        class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg shadow-md p-6 text-white"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-yellow-100 text-sm font-medium">En attente</p>
            <p class="text-3xl font-bold mt-1">{{ stats.enAttente }}</p>
          </div>
          <i class="pi pi-clock text-4xl opacity-50"></i>
        </div>
      </div>

      <!-- Actifs -->
      <div
        class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-md p-6 text-white"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-green-100 text-sm font-medium">Actifs</p>
            <p class="text-3xl font-bold mt-1">{{ stats.actifs }}</p>
          </div>
          <i class="pi pi-check-circle text-4xl opacity-50"></i>
        </div>
      </div>

      <!-- Suspendus -->
      <div
        class="bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-md p-6 text-white"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-red-100 text-sm font-medium">Suspendus</p>
            <p class="text-3xl font-bold mt-1">{{ stats.suspendus }}</p>
          </div>
          <i class="pi pi-ban text-4xl opacity-50"></i>
        </div>
      </div>
    </div>

    <!-- üîç Barre de recherche et filtres -->
    <div
      class="bg-gray-50 rounded-lg shadow-sm p-6 mb-6 border border-gray-200"
    >
      <div
        class="flex flex-col md:flex-row gap-4 items-stretch md:items-center"
      >
        <!-- Recherche -->
        <div class="flex-1 md:flex-[2]">
          <div class="relative w-full">
            <i
              class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
            ></i>
            <input
              pInputText
              type="text"
              [(ngModel)]="searchTerm"
              (keyup.enter)="onSearch()"
              placeholder="Rechercher par nom, m√©tier, ville..."
              class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
        </div>

        <!-- Filtre Statut -->
        <div class="w-full md:w-auto md:flex-1">
          <p-dropdown
            [options]="statuts"
            [(ngModel)]="selectedStatut"
            (onChange)="onFilterChange()"
            optionLabel="label"
            placeholder="Statut"
            [style]="{ width: '100%' }"
          ></p-dropdown>
        </div>

        <!-- Filtre Ville -->
        <div class="w-full md:w-auto md:flex-1">
          <p-dropdown
            [options]="villes"
            [(ngModel)]="selectedVille"
            (onChange)="onFilterChange()"
            optionLabel="label"
            placeholder="Ville"
            [style]="{ width: '100%' }"
          ></p-dropdown>
        </div>

        <!-- Bouton R√©initialiser -->
        <div class="w-full md:w-auto">
          <button
            pButton
            icon="pi pi-refresh"
            label="R√©initialiser"
            (click)="resetFilters()"
            class="p-button-outlined p-button-secondary w-full md:w-auto"
          ></button>
        </div>
      </div>
    </div>

    <!-- üìä Tableau des prestataires -->
    <div
      class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"
    >
      <p-table
        [value]="providers"
        [paginator]="true"
        [rows]="limit"
        [totalRecords]="totalRecords"
        [loading]="loading"
        [lazy]="true"
        (onLazyLoad)="onPageChange($event)"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Affichage de {first} √† {last} sur {totalRecords} prestataires"
        styleClass="p-datatable-sm"
        [tableStyle]="{ 'min-width': '60rem' }"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 80px" class="bg-gray-50">Photo</th>
            <th class="bg-gray-50">Nom</th>
            <th class="bg-gray-50">M√©tier</th>
            <th class="bg-gray-50">Ville</th>
            <th class="bg-gray-50">Statut</th>
            <th class="bg-gray-50">Note</th>
            <th class="bg-gray-50">Missions</th>
            <th class="bg-gray-50">Inscription</th>
            <th style="width: 150px" class="bg-gray-50">Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-provider>
          <tr class="hover:bg-gray-50 transition-colors">
            <!-- Photo -->
            <td>
              <div class="relative">
                <img
                  [src]="provider.photo || 'assets/avatar-default.png'"
                  [alt]="provider.prenom"
                  class="w-12 h-12 rounded-full object-cover border-2 border-gray-200"
                />
                <i
                  *ngIf="provider.isBoosted"
                  class="pi pi-star-fill absolute -top-1 -right-1 text-yellow-400 text-xs bg-white rounded-full p-0.5"
                  pTooltip="Mis en avant"
                ></i>
              </div>
            </td>

            <!-- Nom -->
            <td class="font-semibold text-gray-900">
              {{ provider.prenom }} {{ provider.nom }}
            </td>

            <!-- M√©tier -->
            <td>
              <div class="flex items-center gap-2">
                <i class="pi pi-briefcase text-gray-400"></i>
                <span class="text-gray-700">{{ provider.metier }}</span>
              </div>
            </td>

            <!-- Ville -->
            <td>
              <div class="flex items-center gap-2">
                <i class="pi pi-map-marker text-gray-400"></i>
                <span class="text-gray-600">{{ provider.ville }}</span>
              </div>
            </td>

            <!-- Statut -->
            <td>
              <p-tag
                [value]="getStatutLabel(provider.statut)"
                [severity]="getStatutSeverity(provider.statut)"
              ></p-tag>
            </td>

            <!-- Note -->
            <td>
              <div
                *ngIf="provider.nombreAvis > 0"
                class="flex items-center gap-1"
              >
                <i class="pi pi-star-fill text-yellow-400"></i>
                <span class="font-semibold">{{ provider.noteGenerale }}</span>
                <span class="text-sm text-gray-500"
                  >({{ provider.nombreAvis }})</span
                >
              </div>
              <span
                *ngIf="provider.nombreAvis === 0"
                class="text-gray-400 text-sm"
              >
                Aucun avis
              </span>
            </td>

            <!-- Missions -->
            <td class="text-center">
              <span class="font-semibold text-gray-700">
                {{ provider.nombreMissions }}
              </span>
            </td>

            <!-- Date inscription -->
            <td class="text-gray-600 text-sm">
              {{ provider.dateInscription | date : "dd/MM/yyyy" }}
            </td>

            <!-- Actions -->
            <td>
              <div class="flex gap-2">
                <button
                  pButton
                  icon="pi pi-eye"
                  class="p-button-rounded p-button-info p-button-text"
                  (click)="viewDetails(provider._id)"
                  pTooltip="Voir d√©tails"
                  tooltipPosition="top"
                ></button>

                <!-- Badge en attente -->
                <p-badge
                  *ngIf="provider.statut === 'en_attente'"
                  value="!"
                  severity="warn"
                  [style]="{ 'font-size': '0.75rem' }"
                ></p-badge>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="9" class="text-center py-12">
              <div
                class="flex flex-col items-center justify-center text-gray-500"
              >
                <i class="pi pi-briefcase text-5xl mb-3 text-gray-300"></i>
                <p class="text-lg font-medium">Aucun prestataire trouv√©</p>
                <p class="text-sm text-gray-400 mt-1">
                  Essayez de modifier vos crit√®res de recherche
                </p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- Toast -->
<p-toast position="top-right"></p-toast>
